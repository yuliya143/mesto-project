(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){var n=document.querySelector(".popup_opened");"Escape"===e.code&&t(n)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(e){return"https://nomoreparties.co/v1/plus-cohort-3/".concat(e)},i={headers:{authorization:"d32353b7-29c6-4530-8908-5ae56ac735f5","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject(e)},l=function(e,t){e.json?e.json().then((function(e){t.textContent=e.message})):t.textContent="Что-то пошло не так... :( Попробуйте еще раз."},s=document.querySelector(".gallery__list"),p=document.querySelector(".popup_type_confirmation");function f(e,t){var n=document.querySelector("#place-template").content.querySelector(".place").cloneNode(!0),r=n.querySelector(".place__title"),o=n.querySelector(".place__image"),c=n.querySelector(".place__likes"),u=n.querySelector(".place__icon_type_like"),i=n.querySelector(".place__delete-button");return r.textContent=e.name,c.textContent=e.likes.length||"",e.likes.some((function(e){return e._id===t}))&&u.classList.add("place__icon_active"),n.id=e._id,o.setAttribute("src",e.link),o.setAttribute("alt",e.name),t!==e.owner._id&&i.remove(),function(e){e.addEventListener("error",(function(){return e.removeEventListener("click",Q)}))}(o),function(e){var t=e.querySelector(".place__like-button"),n=e.querySelector(".place__delete-button"),r=e.querySelector(".place__image");t.addEventListener("click",m),r.addEventListener("click",Q),n&&n.addEventListener("click",d)}(n),n}function d(t){var n=t.currentTarget.closest(".place").id;p.dataset.removeCardId=n,e(p)}function _(e){s.prepend(e)}function m(e){var t,n=e.currentTarget.querySelector(".place__icon_type_like"),r=e.currentTarget.closest(".place"),c=r.id,l=r.querySelector(".place__likes");n.classList.contains("place__icon_active")?function(e){return fetch(u("cards/likes/".concat(e)),o({method:"DELETE"},i)).then(a)}(c).then((function(e){l.textContent=e.likes.length||"",n.classList.remove("place__icon_active")})).catch(console.log):(t=c,fetch(u("cards/likes/".concat(t)),o({method:"PUT"},i)).then(a)).then((function(e){l.textContent=e.likes.length||"",n.classList.add("place__icon_active")})).catch(console.log)}var y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__button"),S=document.querySelector(".profile__avatar-button"),h=document.querySelector(".popup__button"),b=document.querySelector(".popup_type_profile"),q=document.querySelector(".popup_type_place"),E=document.querySelector(".popup_type_avatar"),g=document.querySelector(".popup_type_confirmation"),C=document.querySelector(".form_type_profile"),L=document.querySelector(".form__input_el_full-name"),k=document.querySelector(".form__input_el_occupation"),O=document.querySelector(".profile__name"),x=document.querySelector(".profile__profession"),j=C.querySelector(".form__button"),P=C.querySelector(".form__error"),T=document.querySelector(".form_type_place"),A=document.querySelector(".form__input_el_new-place"),w=document.querySelector(".form__input_el_link-image"),D=T.querySelector(".form__button"),B=T.querySelector(".form__error"),N=document.querySelector(".form_type_avatar"),I=document.querySelector(".form__input_el_avatar"),J=document.querySelector(".profile__photo"),G=N.querySelector(".form__button"),H=N.querySelector(".form__error"),z=document.querySelector(".popup_type_photo"),M=document.querySelector(".popup__image"),U=document.querySelector(".popup__caption");function F(e){var n=e.currentTarget,r=e.target.closest(".popup__close-button"),o=e.target.classList.contains("popup");(r||o)&&t(n)}function K(e){var t=e,n=t.textContent;return function(e){t.textContent=e?"Сохранение...":n}}function Q(t){t.preventDefault();var n,r,o=t.target;n=o.src,r=o.alt,M.setAttribute("src",n),M.setAttribute("alt",r),U.textContent=r,e(z)}var R=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1},V=function(e,t){e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n,r){(function(e,t){e.validity.valid?function(e,t){document.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(t.inputErrorClass)}(e,t):function(e,t){var n=document.querySelector("#".concat(e.id,"-error"));e.classList.add(t.inputErrorClass),n.textContent=e.validationMessage}(e,t)})(e,r),R(t,n)}(e,r,n,t)}))})),e.addEventListener("reset",(function(){setTimeout((function(){R(r,n)}))})),R(r,n)};y.addEventListener("click",(function(){L.value=O.textContent,k.value=x.textContent,j.disabled=!1,e(b)})),v.addEventListener("click",(function(){return e(q)})),S.addEventListener("click",(function(){return e(E)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",F)})),C.addEventListener("submit",(function(e){e.preventDefault(),P.textContent="";var n=K(j);n(!0);var r,c=L.value.trim(),s=k.value.trim();(r={name:c,about:s},fetch(u("users/me"),o(o({method:"PATCH"},i),{},{body:JSON.stringify({name:r.name,about:r.about})})).then(a)).then((function(){O.textContent=c,x.textContent=s,t(b)})).catch((function(e){return l(e,P)})).finally((function(){n(!1)}))})),T.addEventListener("submit",(function(e){e.preventDefault(),B.textContent="";var n,r=K(D);r(!0),(n={name:A.value.trim(),link:w.value.trim()},fetch(u("cards"),o(o({method:"POST"},i),{},{body:JSON.stringify({name:n.name,link:n.link})})).then(a)).then((function(e){_(f(e,e.owner._id)),t(q),T.reset()})).catch((function(e){return l(e,B)})).finally((function(){r(!1)}))})),N.addEventListener("submit",(function(e){e.preventDefault(),H.textContent="";var n=K(G);n(!0);var r,c=I.value;(r={avatar:c},fetch(u("users/me/avatar"),o(o({method:"PATCH"},i),{},{body:JSON.stringify({avatar:r.avatar})})).then(a)).then((function(){console.log(),J.setAttribute("src",c),t(E),N.reset()})).catch((function(e){return l(e,H)})).finally((function(){n(!1)}))})),h.addEventListener("click",(function(e){var n,r=g.dataset.removeCardId;(n=r,fetch(u("cards/".concat(n)),o({method:"DELETE"},i)).then(a)).then((function(){document.getElementById(r).remove(),t(g)})).catch(console.log)})),fetch(u("users/me"),o({method:"GET"},i)).then((function(e){return a(e)})).then((function(e){return function(e){O.textContent=e.name,x.textContent=e.about,J.src=e.avatar}(e),t=e._id,fetch(u("cards"),o({method:"GET"},i)).then(a).then((function(e){e.reverse().forEach((function(e){_(f(e,t))}))}));var t})).then((function(){document.querySelector(".spinner").classList.remove("spinner_active")})).catch((function(e){return alert("Что-то пошло не так... :(")})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){V(t,e)}))}({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"})})();